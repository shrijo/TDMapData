<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="initial-scale=1,maximum-scale=1,user-scalable=no" />
    <title>Two Synced Maps</title>
    <!--
      Load the ArcGIS Maps SDK for JavaScript from CDN.
      Using version 4.33 which is the latest as of August 2025.
    -->
    <link rel="stylesheet" href="https://js.arcgis.com/4.33/esri/themes/light/main.css" />
    <script src="https://js.arcgis.com/4.33/"></script>
    <style>
      /* Base styles for the page and containers */
      html,
      body {
        padding: 0;
        margin: 0;
        height: 100%;
        width: 100%;
        background-color: #f3f4f6; /* A light gray background */
      }
      .container {
        display: flex; /* Use flexbox for horizontal layout */
        justify-content: center;
        align-items: center;
        width: 100%;
        height: 100vh; /* Make the container take up the full viewport height */
        gap: 0; /* Remove gap between the squares */
      }
      /* Map containers, each taking up half the width and fixed height */
      .map-container {
        width: 50%;
        height: 512px;
        box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
        border: 1px solid #d1d5db;
      }
    </style>
  </head>
  <body>
    <!-- The main container for the two maps -->
    <div class="container">
      <div id="view1Div" class="map-container"></div>
      <div id="view2Div" class="map-container"></div>
    </div>

    <!-- The JavaScript logic -->
    <script>
      require([
        "esri/config", // New: to set the API key directly
        "esri/Map",
        "esri/views/MapView",
        "esri/layers/ImageryLayer",
        "esri/renderers/RasterStretchRenderer",
        "esri/core/reactiveUtils"
      ], (esriConfig, Map, MapView, ImageryLayer, RasterStretchRenderer, reactiveUtils) => {
        // This is the new, more direct way to set the API key.
        // It should prevent the map from getting stuck.
        esriConfig.apiKey = "";

        // --- Setup the Satellite Map View ---
        const satelliteMap = new Map({
          basemap: "satellite"
        });

        const satelliteView = new MapView({
          container: "view1Div",
          map: satelliteMap,
          center: [-118.805, 34.027], // Default to a California location
          zoom: 13,
          ui: { components: [] } // Remove all UI components for a clean look
        });

        // --- Setup the DEM Heightmap View ---
        const demRenderer = new RasterStretchRenderer({
          stretchType: "min-max",
          colorRamp: {
            type: "multipart",
            stops: [{
              color: [0, 0, 0, 255],
              value: -100 // Black for low values
            }, {
              color: [255, 255, 255, 255],
              value: 4000 // White for high values
            }]
          }
        });

        const demLayer = new ImageryLayer({
          url: "https://elevation.arcgis.com/arcgis/rest/services/WorldElevation/Terrain/ImageServer",
          renderer: demRenderer,
          format: "jpg"
        });

        const demMap = new Map({
          layers: [demLayer]
        });

        const demView = new MapView({
          container: "view2Div",
          map: demMap,
          center: [-118.805, 34.027],
          zoom: 13,
          ui: { components: [] }
        });

        // --- Sync the two views ---
        Promise.all([
          satelliteView.when(),
          demView.when()
        ]).then(() => {
          // Sync the viewpoints to move together
          const sync = (view1, view2) => {
            reactiveUtils.watch(
              () => view1.viewpoint,
              (viewpoint) => {
                view2.viewpoint = viewpoint;
              },
              { deep: true }
            );
          };

          sync(satelliteView, demView);
          sync(demView, satelliteView);
        }).catch(error => {
          console.error("Map initialization failed:", error);
          // Add a simple error message to the page
          document.body.innerHTML = "<p style='text-align:center; color:red;'>Error loading maps. Please check the console for details.</p>";
        });
      });
    </script>
  </body>
</html>

