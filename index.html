<!DOCTYPE html>

<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>TouchDesigner Map Viewer</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

```
    body {
        height: 100vh;
        width: 100vw;
        overflow: hidden;
        background: #000;
    }
    
    .split-container {
        display: flex;
        height: 100vh;
        width: 100vw;
    }
    
    .left-panel, .right-panel {
        flex: 1;
        height: 100vh;
        position: relative;
    }
    
    .map-view {
        width: 100%;
        height: 100%;
        cursor: grab;
    }
    
    .map-view:active {
        cursor: grabbing;
    }
    
    .grayscale-filter {
        filter: grayscale(100%) contrast(150%) brightness(120%);
    }
</style>
```

</head>
<body>
    <div class="split-container">
        <div class="left-panel">
            <div id="satellite-view" class="map-view"></div>
        </div>
        <div class="right-panel">
            <div id="elevation-view" class="map-view"></div>
        </div>
    </div>

```
<script>
    let map1, map2;
    let currentZoom = 10;
    let currentCenter = [40.7128, -74.0060]; // NYC default
    
    // Initialize maps when Leaflet is ready
    function initializeMaps() {
        // Left panel - Satellite imagery
        map1 = L.map('satellite-view', {
            center: currentCenter,
            zoom: currentZoom,
            zoomControl: false
        });
        
        // ESRI World Imagery for left side
        L.tileLayer('https://server.arcgisonline.com/ArcGIS/rest/services/World_Imagery/MapServer/tile/{z}/{y}/{x}', {
            attribution: 'Â© Esri',
            maxZoom: 19
        }).addTo(map1);
        
        // Right panel - ESRI World Terrain Base (working terrain layer)
        map2 = L.map('elevation-view', {
            center: currentCenter,
            zoom: currentZoom,
            zoomControl: false
        });
        
        // Right panel - Try Stamen Terrain first (more reliable)
        map2 = L.map('elevation-view', {
            center: currentCenter,
            zoom: currentZoom,
            zoomControl: false
        });
        
        // First try a basic working terrain layer to test
        const workingTerrain = L.tileLayer('https://stamen-tiles-{s}.a.ssl.fastly.net/terrain/{z}/{x}/{y}.png', {
            attribution: 'Stamen Terrain',
            maxZoom: 14,
            subdomains: ['a', 'b', 'c', 'd']
        });
        
        workingTerrain.on('tileload', function() {
            console.log('Stamen terrain loaded - now switching to height data...');
            // Once we confirm terrain works, switch to height data
            setTimeout(() => {
                map2.removeLayer(workingTerrain);
                
                // Try simpler elevation service
                const elevationLayer = L.tileLayer('https://cloud.maptiler.com/tiles/terrain-rgb/{z}/{x}/{y}.png', {
                    attribution: 'MapTiler Height Data',
                    maxZoom: 12
                });
                
                elevationLayer.on('tileerror', function() {
                    console.log('Height tiles failed - using grayscale conversion');
                    // Fallback: use regular terrain but convert to grayscale
                    map2.removeLayer(elevationLayer);
                    const grayTerrain = L.tileLayer('https://stamen-tiles-{s}.a.ssl.fastly.net/terrain/{z}/{x}/{y}.png', {
                        attribution: 'Terrain as heightmap',
                        maxZoom: 14,
                        subdomains: ['a', 'b', 'c', 'd'],
                        className: 'grayscale-filter'
                    });
                    grayTerrain.addTo(map2);
                });
                
                elevationLayer.addTo(map2);
            }, 2000);
        });
        
        workingTerrain.on('tileerror', function() {
            console.log('All tile services failed - check network/CORS');
            document.getElementById('elevation-view').innerHTML = '<div style="display:flex;align-items:center;justify-content:center;height:100%;color:white;font-size:16px;text-align:center;">Tile services blocked<br>Check console for errors</div>';
        });
        
        workingTerrain.addTo(map2);
        
        // Sync the maps
        let isSyncing = false;
        
        function syncMaps(sourceMap, targetMap) {
            if (isSyncing) return;
            isSyncing = true;
            
            const center = sourceMap.getCenter();
            const zoom = sourceMap.getZoom();
            
            targetMap.setView(center, zoom);
            
            setTimeout(() => {
                isSyncing = false;
            }, 100);
        }
        
        // Add sync event listeners
        map1.on('moveend', () => syncMaps(map1, map2));
        map1.on('zoomend', () => syncMaps(map1, map2));
        map2.on('moveend', () => syncMaps(map2, map1));
        map2.on('zoomend', () => syncMaps(map2, map1));
    }
    
    // Load Leaflet library
    function loadLeaflet() {
        // Add Leaflet CSS
        const leafletCSS = document.createElement('link');
        leafletCSS.rel = 'stylesheet';
        leafletCSS.href = 'https://unpkg.com/leaflet@1.9.4/dist/leaflet.css';
        document.head.appendChild(leafletCSS);
        
        // Add Leaflet JS
        const leafletJS = document.createElement('script');
        leafletJS.src = 'https://unpkg.com/leaflet@1.9.4/dist/leaflet.js';
        leafletJS.onload = function() {
            initializeMaps();
        };
        leafletJS.onerror = function() {
            // Fallback if Leaflet fails to load
            document.getElementById('satellite-view').innerHTML = '<div style="display:flex;align-items:center;justify-content:center;height:100%;color:white;font-size:18px;">Network blocked - Leaflet library failed to load</div>';
            document.getElementById('elevation-view').innerHTML = '<div style="display:flex;align-items:center;justify-content:center;height:100%;color:white;font-size:18px;">Use local server or enable external resources</div>';
        };
        document.head.appendChild(leafletJS);
    }
    
    // Start loading
    loadLeaflet();
</script>
```

</body>
</html>